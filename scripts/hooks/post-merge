#!/bin/bash

# =============================================================================
# Post-merge hook - Reminder for AI agents
# Shows breadcrumbs about post-merge tasks
# =============================================================================

BRANCH=$(git rev-parse --abbrev-ref HEAD)
echo ""
echo "üìç Merged into: $BRANCH"

# Remind about schema sync
if command -v atlas &>/dev/null; then
    if atlas schema diff --env local 2>/dev/null | grep -q .; then
        echo "‚ö†Ô∏è  Schema may differ from schema.sql"
        echo "   Run: make schema-diff   (preview)"
        echo "   Run: make schema-apply  (apply changes)"
    else
        echo "‚úì Schema appears in sync"
    fi
else
    echo "üí° Atlas not installed - run: brew install ariga/tap/atlas"
fi

# Master/main branch reminders
if [[ "$BRANCH" == "master" || "$BRANCH" == "main" ]]; then
    echo ""
    echo "üìã Master branch checklist:"
    echo "   [ ] make init          # Initialize dependencies"
    echo "   [ ] make install       # Install orc binary"
    echo "   [ ] make deploy-glue   # Deploy Claude Code glue"
    echo "   [ ] make test          # Verify tests pass"

    # Environment health check
    if command -v orc &>/dev/null; then
        echo ""
        echo "üè• Running environment health check..."
        if orc doctor --quiet; then
            echo "‚úì Environment healthy"
        else
            echo "‚ö†Ô∏è  Environment issues detected - run: orc doctor"
        fi
    fi

fi
echo ""
